syntax = "proto3";

package mcsv;

// Go package path (required for OpenAPI generation)
option go_package = "github.com/msvc/protos";

// Request to convert an image (PNG/JPEG) to PDF
message ImageConversionRequest {
  string user_id = 1;
  string user_email = 2;

  // EITHER image_url OR image_data (prefer image_url for microservices)
  string image_url = 3;         // URL to fetch image from (e.g., http://user_svc/ImageLoader/job_123)
  bytes image_data = 9;         // Raw image binary data (deprecated, use image_url instead)

  // Input format (png, jpeg, jpg)
  string input_format = 4;

  // PDF conversion options
  string pdf_quality = 5;       // "low", "medium", "high", "lossless"
  bool strip_metadata = 6;      // Remove EXIF data
  int32 max_width = 7;          // Resize if larger (0 = no resize)
  int32 max_height = 8;         // Resize if larger (0 = no resize)

  // Storage tracking - used to clean up stored images
  string storage_id = 10;       // Unique storage identifier for cleanup
}

// Response after image conversion
message ImageConversionResponse {
  bool success = 1;
  string message = 2;

  // Converted PDF binary data
  bytes pdf_data = 3;

  // Metrics
  int64 input_size = 4;          // Original image size in bytes
  int64 output_size = 5;         // PDF size in bytes

  // Image info
  int32 width = 6;
  int32 height = 7;

  // Storage tracking - separate fields for PNG and PDF
  string storage_id = 8;         // PDF storage_id (result)
  string original_storage_id = 9; // PNG storage_id (to delete)
  string pdf_url = 10;           // MinIO/S3 URL where PDF is stored

  // User context
  string user_email = 11;        // User who initiated the conversion
}
